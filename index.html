<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="pageTitle">ŸÖŸêÿπÿØÿßÿØ ÿßŸÑÿ∞ŸÉÿßÿ°</title>
    <link id="favicon" rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßÆ</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@600;900&family=Poppins:wght@600;900&display=swap');

        :root {
            --wood: #3d2b1f;
            --bead-5: #3498db;
            --bead-1: #2ecc71;
            --bead-active: #f39c12;
            --primary: #8b5cf6;
        }

        body {
            background: radial-gradient(circle at center, #1e1b4b, #0f172a);
            min-height: 100vh;
            color: white;
            font-family: 'Cairo', 'Poppins', sans-serif;
            margin: 0;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        @keyframes float {
            0% { transform: translateY(0px) scale(1); filter: drop-shadow(0 5px 15px rgba(251, 191, 36, 0.4)); }
            50% { transform: translateY(-10px) scale(1.02); filter: drop-shadow(0 20px 30px rgba(251, 191, 36, 0.6)); }
            100% { transform: translateY(0px) scale(1); filter: drop-shadow(0 5px 15px rgba(251, 191, 36, 0.4)); }
        }

        .logo-animated {
            font-size: clamp(2rem, 8vw, 4rem); 
            font-weight: 900; 
            display: inline-block;
            animation: float 4s ease-in-out infinite;
            background: linear-gradient(to bottom, #fde68a, #fbbf24, #d97706);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            cursor: default;
            text-align: center;
        }

        /* ÿ¨ÿπŸÑ ÿßŸÑÿ•ÿ∑ÿßÿ± ŸÖÿ±ŸÜÿßŸã ŸÑŸäÿ™ŸÜÿßÿ≥ÿ® ŸÖÿπ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ */
        .abacus-frame {
            background: var(--wood); 
            padding: clamp(40px, 10vw, 80px) clamp(5px, 2vw, 30px) 40px;
            border: clamp(8px, 2vw, 15px) solid #1a130e; 
            border-radius: clamp(20px, 5vw, 50px);
            position: relative; 
            box-shadow: 0 50px 100px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
            display: flex; 
            gap: clamp(2px, 1vw, 15px); 
            max-width: 98vw; 
            margin-top: 20px;
            justify-content: center;
        }

        .middle-beam { 
            position: absolute; left: 0; right: 0; 
            top: clamp(140px, 35vw, 185px); 
            height: clamp(12px, 3vw, 22px); 
            background: #2a1d15; z-index: 50; 
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.8); 
        }

        .column { 
            width: clamp(38px, 11vw, 85px); 
            height: clamp(380px, 95vw, 520px); 
            position: relative; 
            display: flex; flex-direction: column; align-items: center; 
        }

        .rod { 
            position: absolute; left: 50%; transform: translateX(-50%); 
            width: clamp(4px, 1vw, 12px); 
            height: 100%; 
            background: linear-gradient(to right, #334155, #94a3b8, #334155); 
            z-index: 1; border-radius: 6px; 
        }

        .bead { 
            width: 95%; 
            height: clamp(30px, 7vw, 50px); 
            clip-path: polygon(15% 0%, 85% 0%, 100% 50%, 85% 100%, 15% 100%, 0% 50%); 
            position: absolute; cursor: pointer; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            z-index: 60; display: flex; align-items: center; justify-content: center; 
            font-weight: 900; color: white; 
            font-size: clamp(0.8rem, 2.5vw, 1.2rem); 
            user-select: none;
        }
        
        .bead-5 { background: var(--bead-5); top: 20px; }
        .bead-5.active { transform: translateY(clamp(80px, 20vw, 115px)); background: var(--bead-active); box-shadow: 0 0 20px var(--bead-active); }
        
        .bead-1 { background: var(--bead-1); }
        /* ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÜÿ≥ÿ®Ÿäÿ© ŸÑŸÑŸÖÿ≥ÿßŸÅÿßÿ™ */
        .idx-1 { top: clamp(170px, 45vw, 220px); } 
        .idx-2 { top: calc(clamp(170px, 45vw, 220px) + clamp(35px, 8vw, 55px)); } 
        .idx-3 { top: calc(clamp(170px, 45vw, 220px) + clamp(35px, 8vw, 55px) * 2); } 
        .idx-4 { top: calc(clamp(170px, 45vw, 220px) + clamp(35px, 8vw, 55px) * 3); }
        
        .bead-1.active { transform: translateY(clamp(-25px, -6vw, -35px)); background: var(--bead-active); box-shadow: 0 0 20px var(--bead-active); }

        .modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px); z-index: 2000; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #1e293b; border: 4px solid var(--primary); border-radius: 40px;
            padding: clamp(20px, 5vw, 50px); max-width: 550px; width: 90%; text-align: center;
            transform: scale(0.8); opacity: 0; transition: 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }

        .stat-card {
            background: rgba(30, 41, 59, 0.8); padding: 10px 15px; border-radius: 20px;
            border: 2px solid var(--primary); display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); min-width: clamp(80px, 20vw, 120px);
        }

        .btn-fancy {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            padding: 12px clamp(20px, 5vw, 35px); border-radius: 20px; font-weight: 900;
            transition: 0.3s; box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
            font-size: clamp(1rem, 4vw, 1.5rem);
        }
        .btn-fancy:hover { transform: translateY(-3px); filter: brightness(1.1); }

        .corner-btn {
            position: fixed; top: 20px; z-index: 1000;
            padding: 8px 15px; border-radius: 12px; font-weight: bold;
            background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;
            font-size: 0.8rem;
        }

        .reset-skill-btn {
            position: fixed; top: 20px; z-index: 1000;
            padding: 8px; border-radius: 12px;
            background: rgba(239, 68, 68, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444;
        }

        .column-label {
            position: absolute; top: -55px; left: 50%; transform: translateX(-50%);
            background: #1e293b; color: #94a3b8; padding: 4px 10px; border-radius: 10px;
            font-size: clamp(0.6rem, 2vw, 0.85rem); white-space: nowrap; border: 1px solid rgba(255,255,255,0.1);
            font-weight: bold; pointer-events: none;
        }

        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿßŸã */
        @media (max-width: 450px) {
            .column-label { display: none; }
            .abacus-frame { padding-top: 30px; }
            .corner-btn, .reset-skill-btn { top: 10px; }
        }
    </style>
</head>
<body>

    <button id="langBtn" onclick="toggleLanguage()" class="corner-btn"></button>
    <button id="resetSkillBtn" onclick="confirmResetSkill()" class="reset-skill-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
    </button>

    <div id="universalModal" class="modal-overlay">
        <div class="modal-content">
            <div id="modalIcon" class="text-6xl mb-6"></div>
            <h2 id="modalTitle" class="text-3xl font-black mb-4"></h2>
            <p id="modalDesc" class="text-lg text-slate-300 mb-8 leading-relaxed"></p>
            <div class="flex flex-wrap gap-4 justify-center" id="modalButtons"></div>
        </div>
    </div>

    <div class="flex flex-col items-center w-full py-8 px-2 mt-10">
        <h1 id="appLogo" class="logo-animated mb-6"></h1>

        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <div class="stat-card">
                <span id="levelLabel" class="text-[10px] uppercase font-black text-indigo-400 mb-1"></span>
                <select id="levelSelector" onchange="jumpToLevel(this.value)" class="bg-slate-900 border-none rounded-lg p-1 cursor-pointer text-white font-bold text-xs"></select>
            </div>

            <div class="stat-card border-amber-500">
                <span id="progLabel" class="text-[10px] uppercase font-black text-amber-400 mb-1"></span>
                <span id="autoLevelBadge" class="text-lg font-black text-amber-200"></span>
            </div>

            <button onclick="generateChallenge()" id="btnChallenge" class="btn-fancy"></button>
        </div>

        <div id="challengeBox" class="hidden bg-slate-900/90 border-4 border-amber-500 p-6 rounded-[30px] mb-6 shadow-2xl transition-all">
            <p id="challengeText" class="text-2xl md:text-3xl font-black text-amber-400 text-center"></p>
        </div>

        <div class="flex gap-4 mb-6">
            <div class="bg-slate-800/60 px-4 py-2 rounded-2xl border-2 border-rose-500 flex items-center gap-2">
                <span class="text-xl">üïí</span>
                <span id="timer" class="text-xl font-black"></span>
            </div>
            <div class="bg-slate-800/60 px-4 py-2 rounded-2xl border-2 border-indigo-500 flex items-center gap-2">
                <span id="eyeIcon" onclick="toggleEye()" class="cursor-pointer text-xl">üëÅÔ∏è</span>
                <span id="total" class="text-xl font-black text-amber-500 opacity-5 blur-xl transition-all"></span>
            </div>
        </div>

        <div class="abacus-frame" id="rodsGrid"></div>
        
        <button onclick="resetAbacus()" id="btnClear" class="mt-8 text-slate-400 hover:text-white transition-colors underline decoration-dotted text-sm"></button>
    </div>

    <script>
        let autoDifficulty = parseInt(localStorage.getItem('abacus_difficulty')) || 1;
        let manualLevel = 1;
        let currentLang = localStorage.getItem('abacus_lang') || 'ar';
        let targetNum = null;
        let sec = 0, timerInterval;
        let eyeVisible = false;

        const i18n = {
            ar: {
                logo: "ŸÖŸêÿπÿØÿßÿØ ÿßŸÑÿ∞ŸÉÿßÿ°",
                langBtn: "English",
                levelLabel: "ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÇÿßÿπÿØÿ©",
                progLabel: "ÿßŸÑÿµÿπŸàÿ®ÿ© ÿßŸÑÿ∞ŸÉŸäÿ©",
                colNames: ["ŸÖŸÑÿßŸäŸäŸÜ", "Ÿ°Ÿ†Ÿ† ÿ£ŸÑŸÅ", "Ÿ°Ÿ† ÿ¢ŸÑÿßŸÅ", "ÿ£ŸÑŸÅ", "ŸÖÿ¶ÿßÿ™", "ÿπÿ¥ÿ±ÿßÿ™", "ÿ¢ÿ≠ÿßÿØ"],
                levels: ["Ÿ°. ÿßŸÑÿ¢ÿ≠ÿßÿØ", "Ÿ¢. ÿßŸÑÿπÿ¥ÿ±ÿßÿ™", "Ÿ£. ÿßŸÑŸÖÿ¶ÿßÿ™", "Ÿ§. ÿßŸÑÿ£ŸÑŸàŸÅ", "Ÿ•. ÿπÿ¥ÿ±ÿßÿ™ ÿßŸÑÿ£ŸÑŸàŸÅ", "Ÿ¶. ŸÖÿ¶ÿßÿ™ ÿßŸÑÿ£ŸÑŸàŸÅ", "Ÿß. ÿßŸÑŸÖŸÑÿßŸäŸäŸÜ"],
                startBtn: "ÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ üéØ",
                clearBtn: "ÿ™ÿµŸÅŸäÿ± ÿßŸÑŸÖÿπÿØÿßÿØ",
                challenge: "ŸÖÿ´ŸÑ ÿßŸÑÿ±ŸÇŸÖ: ",
                successTitle: "ÿ±ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã! üèÜ",
                successDesc: "ŸÑŸÇÿØ ŸÜÿ¨ÿ≠ÿ™ ŸÅŸä ÿ≠ŸÑ ÿßŸÑŸÖÿ≥ÿ£ŸÑÿ©. ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ≥ÿ™ÿπÿØ ŸÑÿ™ÿ≠ÿØŸä ÿ£ÿµÿπÿ® ŸÇŸÑŸäŸÑÿßŸãÿü",
                nextLevel: "ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ™ÿßŸÑŸä (ÿ£ÿµÿπÿ®) üöÄ",
                stay: "ÿ±ŸÇŸÖ ÿ¢ÿÆÿ± ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿµÿπŸàÿ®ÿ©",
                maxLvl: "ÿ£ŸÜÿ™ ÿßŸÑÿ¢ŸÜ ŸÅŸä ŸÇŸÖÿ© ÿßŸÑÿ∞ŸÉÿßÿ°! üëë",
                confirmResetTitle: "ÿ•ÿπÿßÿØÿ© ÿ™ÿµŸÅŸäÿ± ÿßŸÑŸÖÿ≥ÿ™ŸàŸâÿü",
                confirmResetDesc: "ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ™ŸÇÿØŸÖŸÉ ÿßŸÑÿ∞ŸÉŸä ŸàÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ£ŸàŸÑ. ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿü",
                resetBtn: "ŸÜÿπŸÖÿå ÿßÿ®ÿØÿ£ ŸÖŸÜ ÿ¨ÿØŸäÿØ",
                cancelBtn: "ÿ•ŸÑÿ∫ÿßÿ°"
            },
            en: {
                logo: "MindAbacus",
                langBtn: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
                levelLabel: "Base Selection",
                progLabel: "Smart Difficulty",
                colNames: ["Millions", "100K", "10K", "Thousands", "Hundreds", "Tens", "Units"],
                levels: ["1. Units", "2. Tens", "3. Hundreds", "4. Thousands", "5. 10K", "6. 100K", "7. Millions"],
                startBtn: "New Challenge üéØ",
                clearBtn: "Clear Abacus",
                challenge: "Show: ",
                successTitle: "Amazing! üèÜ",
                successDesc: "You solved it! Ready for a harder challenge?",
                nextLevel: "Next Challenge (Harder) üöÄ",
                stay: "Same difficulty",
                maxLvl: "You are an Abacus Master! üëë",
                confirmResetTitle: "Reset Progress?",
                confirmResetDesc: "Your smart progress will be cleared and you will return to level 1. Are you sure?",
                resetBtn: "Yes, Reset Now",
                cancelBtn: "Cancel"
            }
        };

        function formatNum(n) {
            if (currentLang === 'ar') return n.toLocaleString('ar-EG');
            return n.toLocaleString('en-US');
        }

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            localStorage.setItem('abacus_lang', currentLang);
            applyUI();
        }

        function applyUI() {
            const t = i18n[currentLang];
            const isAr = currentLang === 'ar';
            document.title = t.logo;
            document.getElementById('mainHtml').dir = isAr ? 'rtl' : 'ltr';
            document.getElementById('appLogo').innerText = t.logo;
            document.getElementById('langBtn').innerText = t.langBtn;
            document.getElementById('levelLabel').innerText = t.levelLabel;
            document.getElementById('progLabel').innerText = t.progLabel;
            document.getElementById('btnChallenge').innerText = t.startBtn;
            document.getElementById('btnClear').innerText = t.clearBtn;
            document.getElementById('autoLevelBadge').innerText = formatNum(autoDifficulty);
            document.getElementById('timer').innerText = formatNum(sec);
            
            const selector = document.getElementById('levelSelector');
            const currentVal = selector.value || manualLevel;
            selector.innerHTML = '';
            t.levels.forEach((l, i) => {
                const opt = document.createElement('option');
                opt.value = i + 1; opt.innerText = l;
                opt.selected = (i + 1 == currentVal);
                selector.appendChild(opt);
            });

            const langBtn = document.getElementById('langBtn');
            const resBtn = document.getElementById('resetSkillBtn');
            if(isAr) { langBtn.style.left="20px"; langBtn.style.right="auto"; resBtn.style.right="20px"; resBtn.style.left="auto"; }
            else { langBtn.style.right="20px"; langBtn.style.left="auto"; resBtn.style.left="20px"; resBtn.style.right="auto"; }
            
            initAbacus();
            updateDisplayValue();
        }

        function initAbacus() {
            const grid = document.getElementById('rodsGrid');
            const t = i18n[currentLang];
            grid.innerHTML = '<div class="middle-beam"></div>';
            for(let i=0; i<7; i++) {
                const col = document.createElement('div');
                col.className = 'column';
                col.innerHTML = `
                    <div class="column-label">${t.colNames[i]}</div>
                    <div class="rod"></div>
                    <div class="bead bead-5" onclick="toggleBead(this)">${formatNum(5)}</div>
                    <div class="bead bead-1 idx-1" onclick="handleLower(this, 1)">${formatNum(1)}</div>
                    <div class="bead bead-1 idx-2" onclick="handleLower(this, 2)">${formatNum(1)}</div>
                    <div class="bead bead-1 idx-3" onclick="handleLower(this, 3)">${formatNum(1)}</div>
                    <div class="bead bead-1 idx-4" onclick="handleLower(this, 4)">${formatNum(1)}</div>
                `;
                grid.appendChild(col);
            }
            if(targetNum) updateChallengeText();
        }

        function updateDisplayValue() {
            let total = 0n;
            const cols = document.querySelectorAll('.column');
            cols.forEach((col, i) => {
                let v = col.querySelector('.bead-5').classList.contains('active') ? 5 : 0;
                v += col.querySelectorAll('.bead-1.active').length;
                total += BigInt(v) * (10n ** BigInt(cols.length - 1 - i));
            });
            document.getElementById('total').innerText = formatNum(total);
            return total;
        }

        function checkResult() {
            const total = updateDisplayValue();
            if(targetNum !== null && total === targetNum) {
                stopTimer();
                setTimeout(() => openModal('success'), 400);
            }
        }

        function toggleBead(el) { el.classList.toggle('active'); checkResult(); }

        function handleLower(el, idx) {
            const beads = el.parentElement.querySelectorAll('.bead-1');
            const isActive = el.classList.contains('active');
            beads.forEach((b, i) => {
                if(!isActive && (i+1) <= idx) b.classList.add('active');
                else if(isActive && (i+1) >= idx) b.classList.remove('active');
            });
            checkResult();
        }

        function generateChallenge() {
            resetAbacus(); startTimer();
            const min = 10n ** BigInt(autoDifficulty - 1);
            const max = (10n ** BigInt(autoDifficulty)) - 1n;
            const range = max - min + 1n;
            const randomOffset = BigInt(Math.floor(Math.random() * Number(range < 1000000n ? range : 1000000n)));
            targetNum = min + randomOffset;
            document.getElementById('challengeBox').classList.remove('hidden');
            updateChallengeText();
        }

        function updateChallengeText() { document.getElementById('challengeText').innerText = i18n[currentLang].challenge + formatNum(targetNum); }

        function startTimer() {
            clearInterval(timerInterval); sec = 0;
            document.getElementById('timer').innerText = formatNum(sec);
            timerInterval = setInterval(() => { sec++; document.getElementById('timer').innerText = formatNum(sec); }, 1000);
        }

        function stopTimer() { clearInterval(timerInterval); }

        function resetAbacus() { document.querySelectorAll('.bead').forEach(b => b.classList.remove('active')); updateDisplayValue(); }

        function toggleEye() {
            eyeVisible = !eyeVisible;
            const t = document.getElementById('total');
            const e = document.getElementById('eyeIcon');
            if(eyeVisible) { t.style.opacity = "1"; t.style.filter = "blur(0)"; e.innerText = "üëÅÔ∏è‚Äçüó®Ô∏è"; } 
            else { t.style.opacity = "0.05"; t.style.filter = "blur(20px)"; e.innerText = "üëÅÔ∏è"; }
        }

        function openModal(type) {
            const m = document.getElementById('universalModal');
            const t = i18n[currentLang];
            const icon = document.getElementById('modalIcon');
            const title = document.getElementById('modalTitle');
            const desc = document.getElementById('modalDesc');
            const btns = document.getElementById('modalButtons');
            btns.innerHTML = '';

            if (type === 'success') {
                icon.innerText = "üåü"; title.innerText = t.successTitle; desc.innerText = t.successDesc;
                if (autoDifficulty < 7) {
                    btns.innerHTML = `<button onclick="advanceDifficulty()" class="bg-emerald-600 px-6 py-3 rounded-xl font-black shadow-xl animate-pulse">${t.nextLevel}</button>
                                      <button onclick="closeModal(); generateChallenge();" class="bg-slate-700 px-6 py-3 rounded-xl font-black">${t.stay}</button>`;
                } else {
                    title.innerText = t.maxLvl;
                    btns.innerHTML = `<button onclick="closeModal(); generateChallenge();" class="bg-emerald-600 px-6 py-3 rounded-xl font-black shadow-xl">${t.stay}</button>`;
                }
            } else if (type === 'confirmReset') {
                icon.innerText = "‚ö†Ô∏è"; title.innerText = t.confirmResetTitle; desc.innerText = t.confirmResetDesc;
                btns.innerHTML = `<button onclick="executeResetSkill()" class="bg-rose-600 px-6 py-3 rounded-xl font-black shadow-xl">${t.resetBtn}</button>
                                  <button onclick="closeModal()" class="bg-slate-700 px-6 py-3 rounded-xl font-black">${t.cancelBtn}</button>`;
            }
            m.style.display = "flex"; setTimeout(() => m.classList.add('active'), 50);
        }

        function advanceDifficulty() {
            if (autoDifficulty < 7) { autoDifficulty++; localStorage.setItem('abacus_difficulty', autoDifficulty); applyUI(); }
            closeModal(); setTimeout(generateChallenge, 400);
        }

        function closeModal() {
            const m = document.getElementById('universalModal');
            m.classList.remove('active'); setTimeout(() => m.style.display = "none", 400);
        }

        function executeResetSkill() {
            autoDifficulty = 1; localStorage.setItem('abacus_difficulty', autoDifficulty);
            applyUI(); closeModal(); targetNum = null;
            document.getElementById('challengeBox').classList.add('hidden');
            stopTimer(); resetAbacus();
        }

        function jumpToLevel(val) { manualLevel = parseInt(val); resetAbacus(); document.getElementById('challengeBox').classList.add('hidden'); targetNum = null; stopTimer(); }
        function confirmResetSkill() { openModal('confirmReset'); }

        window.onload = applyUI;
    </script>
</body>
</html>
