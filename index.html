<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ - MindAbacus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&family=Poppins:wght@700;900&display=swap');

        :root {
            --wood-frame: #3d2b1f;
            --bead-5: #3498db;
            --bead-1: #2ecc71;
            --bead-active: #f39c12;
            --beam: #2a1d15;
            --bead-h: 42px; 
        }

        body {
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81, #1e293b);
            background-size: 400% 400% !important;
            animation: gradientBG 15s ease infinite !important;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
            font-family: 'Cairo', 'Poppins', sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .logo-container {
            margin-top: 20px;
            margin-bottom: 10px;
            text-align: center;
            perspective: 1000px;
        }

        .main-logo {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(to right, #fbbf24, #f59e0b, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
            filter: drop-shadow(0 0 15px rgba(251, 191, 36, 0.3));
            animation: logoPulse 3s ease-in-out infinite;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù„Ù…Ø¹Ø§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ */
        .main-logo::after {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, transparent, rgba(255,255,255,0.6), transparent, transparent);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 4s linear infinite;
        }

        @keyframes logoPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.03); filter: brightness(1.2); }
        }

        @keyframes shine {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .lang-switcher { position: absolute; top: 15px; left: 20px; z-index: 100; }
        [dir="ltr"] .lang-switcher { left: auto; right: 20px; }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3); color: white;
            padding: 8px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s;
        }

        .ai-btn { 
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white; padding: 15px 35px; border-radius: 18px; font-weight: 800; 
            cursor: pointer; border: none; transition: 0.3s;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }
        .ai-btn:hover { transform: scale(1.05); filter: brightness(1.1); }

        .status-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(99, 102, 241, 0.5);
            padding: 12px 24px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .reset-level-btn {
            background: rgba(244, 63, 94, 0.15);
            color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.4);
            padding: 6px 14px; border-radius: 10px; font-size: 0.75rem;
            cursor: pointer; transition: 0.3s; font-weight: bold;
            margin-right: 15px;
        }
        .reset-level-btn:hover { background: #f43f5e; color: white; border-color: #f43f5e; }

        .challenge-box { 
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px);
            border: 2px solid #fbbf24; padding: 25px 50px; border-radius: 30px; 
            margin-bottom: 25px; text-align: center; display: none;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.2);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .timer-box { 
            background: rgba(15, 23, 42, 0.8); padding: 12px 28px; border-radius: 50px; 
            border: 2px solid #f43f5e; display: flex; align-items: center; gap: 12px;
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.2);
        }

        .timer-icon-active {
            animation: watchRotate 2.5s infinite linear;
            display: inline-block;
        }
        @keyframes watchRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-wrapper { 
            background: rgba(15, 23, 42, 0.8); padding: 12px 28px; border-radius: 50px; 
            border: 2px solid #8b5cf6; display: flex; align-items: center; gap: 15px; 
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
        }

        .result-value, .timer-value { font-size: 2.2rem; font-weight: 900; color: #fbbf24; min-width: 80px; text-align: center; }
        .result-value { filter: blur(10px); transition: all 0.4s ease; opacity: 0.2; }
        .result-value.show { filter: blur(0); opacity: 1; transform: scale(1.05); }

        .eye-btn {
            background: #334155; border-radius: 50%; width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s;
        }
        .eye-btn:hover { background: #475569; }

        .abacus-container {
            background: var(--wood-frame); padding: 60px 25px 30px 25px;
            border: 12px solid #1a130e; border-radius: 35px;
            position: relative; box-shadow: 0 30px 70px rgba(0,0,0,0.7);
            display: flex; gap: 12px; overflow-x: auto; max-width: 95vw;
            border-bottom-width: 24px;
        }

        .middle-beam { position: absolute; left: 0; right: 0; top: 165px; height: 20px; background: var(--beam); z-index: 50; }
        .column { width: 75px; height: 500px; position: relative; display: flex; flex-direction: column; align-items: center; flex-shrink: 0; }
        .rod { position: absolute; left: 50%; transform: translateX(-50%); width: 8px; height: 100%; background: linear-gradient(to right, #64748b, #cbd5e1, #64748b); z-index: 1; }
        
        .bead { 
            width: 70px; height: var(--bead-h); 
            clip-path: polygon(15% 0%, 85% 0%, 100% 50%, 85% 100%, 15% 100%, 0% 50%); 
            position: absolute; cursor: pointer; transition: all 0.3s; 
            z-index: 60; display: flex; align-items: center; justify-content: center; font-weight: 900;
        }
        
        .bead-5 { background: var(--bead-5); top: 15px; }
        .bead-5.active { transform: translateY(108px); background: var(--bead-active); }
        .bead-1 { background: var(--bead-1); }
        .idx-1 { top: 200px; } .idx-2 { top: 250px; } .idx-3 { top: 300px; } .idx-4 { top: 350px; }
        .bead-1.active { transform: translateY(-25px); background: var(--bead-active); }

        .reset-btn { margin-top: 30px; background: #e11d48; padding: 15px 60px; border-radius: 50px; font-weight: 900; cursor: pointer; color: white; border: none; transition: 0.3s; }
        .reset-btn:hover { background: #f43f5e; transform: scale(1.05); }

        #successModal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92);
            z-index: 2000; align-items: center; justify-content: center; padding: 20px;
            backdrop-filter: blur(12px);
        }
        .success-content {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 4px solid #fbbf24; padding: 50px; border-radius: 40px;
            text-align: center; max-width: 500px; animation: bounceIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .bead-particle { position: absolute; pointer-events: none; width: 10px; height: 10px; background: gold; border-radius: 50%; z-index: 100; }

        /* Responsive Logo */
        @media (max-width: 640px) {
            .main-logo { font-size: 2.2rem; }
        }
    </style>
</head>
<body>

    <div class="lang-switcher">
        <button onclick="toggleLanguage()" id="langToggle" class="lang-btn">English</button>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ -->
    <div id="successModal">
        <div class="success-content">
            <div class="text-7xl mb-6">ğŸ†</div>
            <h2 id="successTitle" class="text-4xl font-black text-amber-400 mb-4">Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„!</h2>
            <p id="successMsg" class="text-xl text-slate-200 mb-8"></p>
            <div class="flex flex-col gap-4">
                <button id="nextBtn" onclick="nextLevel()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-10 py-4 rounded-full font-black text-xl transition-all transform hover:scale-105 shadow-lg">Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ ğŸš€</button>
                <button id="closeBtn" onclick="closeSuccess()" class="text-slate-400 font-bold hover:text-white">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <div class="content-wrapper flex flex-col items-center w-full">
        
        <!-- Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ -->
        <div class="logo-container">
            <h1 id="appLogo" class="main-logo" data-text="Ù…ÙØ¹Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡">Ù…ÙØ¹Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡</h1>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ù…Ù†Ø¸Ù… -->
        <div class="flex flex-col items-center gap-6 mb-8 mt-4">
            <div class="status-card">
                <div class="flex items-center gap-3">
                    <span class="text-indigo-400 font-bold" id="levelLabel">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                    <span class="text-2xl font-black text-white" id="currentLevelDisplay">Ù¡ (Ø¢Ø­Ø§Ø¯)</span>
                </div>
                <div class="w-px h-8 bg-slate-600 mx-2"></div>
                <button id="resetLevelBtn" class="reset-level-btn" onclick="confirmResetProgress()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ğŸ”„</button>
            </div>
            
            <button id="btnChallenge" class="ai-btn" onclick="generateChallenge()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ ğŸ¯</button>
        </div>

        <div id="challengeBox" class="challenge-box">
            <p id="challengeText" class="text-3xl font-black text-amber-400"></p>
        </div>

        <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø±ØªØ¨Ø© -->
        <div class="flex flex-wrap justify-center gap-6 md:gap-12 items-center mb-8">
            <div class="timer-box">
                <span class="text-3xl" id="timerIcon">ğŸ•’</span>
                <div id="timer" class="timer-value">Ù Ù </div>
            </div>
            <div class="result-wrapper">
                <div onclick="toggleVisibility()" id="eyeBtn" class="eye-btn">
                    <span id="eyeIcon">ğŸ‘ï¸</span>
                </div>
                <div id="total" class="result-value">Ù </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø¹Ø¯Ø§Ø¯ -->
        <div class="abacus-container" id="rodsGrid"></div>
        
        <button id="resetBtn" class="reset-btn" onclick="resetAbacus()">ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø¯Ø§Ø¯</button>
    </div>

    <script>
        let targetValue = null;
        let currentTotal = 0n;
        let isVisible = false;
        let currentLang = 'ar';
        let level = 1;
        let sec = 0, interval;

        const i18n = {
            ar: {
                appName: "Ù…ÙØ¹Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡",
                columns: ["Ù…Ù„Ø§ÙŠÙŠÙ†", "Ù¡Ù Ù  Ø£Ù„Ù", "Ù¡Ù  Ø¢Ù„Ø§Ù", "Ø£Ù„Ù", "Ù…Ø¦Ø§Øª", "Ø¹Ø´Ø±Ø§Øª", "Ø¢Ø­Ø§Ø¯"],
                levels: ["Ø¢Ø­Ø§Ø¯", "Ø¹Ø´Ø±Ø§Øª", "Ù…Ø¦Ø§Øª", "Ø£Ù„ÙˆÙ", "Ø¹Ø´Ø±Ø§Øª Ø§Ù„Ø£Ù„ÙˆÙ", "Ù…Ø¦Ø§Øª Ø§Ù„Ø£Ù„ÙˆÙ", "Ù…Ù„Ø§ÙŠÙŠÙ†"],
                btnChallenge: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ ğŸ¯",
                resetBtn: "ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø¯Ø§Ø¯",
                challengeLabel: "Ù…Ø«Ù„ Ø§Ù„Ø±Ù‚Ù…: ",
                successTitle: "Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„! ğŸŒŸ",
                successMsg: "Ù„Ù‚Ø¯ Ù…Ø«Ù„Øª Ø§Ù„Ø±Ù‚Ù… {num} Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ {time} Ø«Ø§Ù†ÙŠØ©!",
                nextBtn: "Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ ğŸš€",
                closeBtn: "Ø¥ØºÙ„Ø§Ù‚",
                levelLabel: "Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ",
                langBtn: "English",
                resetLevelBtnText: "Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ğŸ”„",
                resetConfirm: "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ù‚Ø§Ù‹ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ ÙˆÙ…Ø³Ø­ ØªÙ‚Ø¯Ù…ÙƒØŸ"
            },
            en: {
                appName: "MindAbacus",
                columns: ["Millions", "100K", "10K", "Thousands", "Hundreds", "Tens", "Units"],
                levels: ["Units", "Tens", "Hundreds", "Thousands", "10K", "100K", "Millions"],
                btnChallenge: "Start Challenge ğŸ¯",
                resetBtn: "Reset Abacus",
                challengeLabel: "Represent: ",
                successTitle: "Great Job, Hero! ğŸŒŸ",
                successMsg: "You represented {num} correctly in {time} seconds!",
                nextBtn: "Next Challenge ğŸš€",
                closeBtn: "Close",
                levelLabel: "Level: ",
                langBtn: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                resetLevelBtnText: "Reset ğŸ”„",
                resetConfirm: "Are you sure you want to reset to Level 1 and clear your progress?"
            }
        };

        function saveProgress() {
            localStorage.setItem('abacus_level', level);
            localStorage.setItem('abacus_lang', currentLang);
        }

        function loadProgress() {
            const savedLevel = localStorage.getItem('abacus_level');
            const savedLang = localStorage.getItem('abacus_lang');
            if (savedLevel) level = parseInt(savedLevel);
            if (savedLang) currentLang = savedLang;
            applyLanguageUI();
        }

        function confirmResetProgress() {
            if(confirm(i18n[currentLang].resetConfirm)) {
                level = 1;
                saveProgress();
                updateLevelDisplay();
                resetAbacus();
                document.getElementById('challengeBox').style.display = 'none';
                targetValue = null;
                stopTimer();
            }
        }

        function formatNum(num) {
            return currentLang === 'ar' ? num.toLocaleString('ar-EG') : num.toLocaleString('en-US');
        }

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            applyLanguageUI();
            saveProgress();
        }

        function applyLanguageUI() {
            document.getElementById('mainHtml').dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø§Ø±
            const logo = document.getElementById('appLogo');
            logo.innerText = i18n[currentLang].appName;
            logo.setAttribute('data-text', i18n[currentLang].appName);
            logo.style.fontFamily = currentLang === 'ar' ? 'Cairo' : 'Poppins';

            document.getElementById('langToggle').innerText = i18n[currentLang].langBtn;
            document.getElementById('btnChallenge').innerText = i18n[currentLang].btnChallenge;
            document.getElementById('resetBtn').innerText = i18n[currentLang].resetBtn;
            document.getElementById('levelLabel').innerText = i18n[currentLang].levelLabel;
            document.getElementById('resetLevelBtn').innerText = i18n[currentLang].resetLevelBtnText;
            
            document.getElementById('nextBtn').innerText = i18n[currentLang].nextBtn;
            document.getElementById('closeBtn').innerText = i18n[currentLang].closeBtn;

            updateLevelDisplay();
            initAbacus();
            updateScore();
            if (targetValue) {
                document.getElementById('challengeText').innerText = i18n[currentLang].challengeLabel + formatNum(targetValue);
            }
        }

        function updateLevelDisplay() {
            const display = document.getElementById('currentLevelDisplay');
            display.innerText = (currentLang === 'ar' ? formatNum(level) : level) + " (" + i18n[currentLang].levels[level-1] + ")";
        }

        function initAbacus() {
            const grid = document.getElementById('rodsGrid');
            const colNames = i18n[currentLang].columns;
            grid.innerHTML = '<div class="middle-beam"></div>';
            colNames.forEach((name, i) => {
                const col = document.createElement('div');
                col.className = 'column';
                col.innerHTML = `
                    <div class="absolute -top-10 text-[11px] font-bold text-slate-300 bg-slate-800 px-2 py-0.5 rounded-md border border-slate-600 whitespace-nowrap">${name}</div>
                    <div class="rod"></div>
                    <div class="bead bead-5" onclick="toggleBead(this)">${currentLang === 'ar' ? 'Ù¥' : '5'}</div>
                    <div class="bead bead-1 idx-1" onclick="handleLower(this, 1)">${currentLang === 'ar' ? 'Ù¡' : '1'}</div>
                    <div class="bead bead-1 idx-2" onclick="handleLower(this, 2)">${currentLang === 'ar' ? 'Ù¡' : '1'}</div>
                    <div class="bead bead-1 idx-3" onclick="handleLower(this, 3)">${currentLang === 'ar' ? 'Ù¡' : '1'}</div>
                    <div class="bead bead-1 idx-4" onclick="handleLower(this, 4)">${currentLang === 'ar' ? 'Ù¡' : '1'}</div>
                `;
                grid.appendChild(col);
            });
        }

        function toggleBead(el) { 
            el.classList.toggle('active'); 
            createSparkle(el.getBoundingClientRect().left + 35, el.getBoundingClientRect().top + 20);
            updateScore(); 
        }

        function handleLower(el, idx) {
            const beads = el.parentElement.querySelectorAll('.bead-1');
            const isActive = el.classList.contains('active');
            createSparkle(el.getBoundingClientRect().left + 35, el.getBoundingClientRect().top + 20);
            beads.forEach((b, i) => {
                if (!isActive && (i+1) <= idx) b.classList.add('active');
                else if (isActive && (i+1) >= idx) b.classList.remove('active');
            });
            updateScore();
        }

        function createSparkle(x, y) {
            for(let i=0; i<6; i++) {
                const p = document.createElement('div');
                p.className = 'bead-particle';
                p.style.left = x + 'px'; p.style.top = y + 'px';
                document.body.appendChild(p);
                const angle = Math.random() * Math.PI * 2;
                const dist = 30 + Math.random() * 50;
                p.animate([{ transform: 'translate(0,0) scale(1)', opacity: 1 }, { transform: `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px) scale(0)`, opacity: 0 }], { duration: 600 }).onfinish = () => p.remove();
            }
        }

        function updateScore() {
            let total = 0n;
            const cols = document.querySelectorAll('.column');
            cols.forEach((col, i) => {
                let v = col.querySelector('.bead-5').classList.contains('active') ? 5 : 0;
                v += col.querySelectorAll('.bead-1.active').length;
                total += BigInt(v) * (10n ** BigInt(cols.length - 1 - i));
            });
            currentTotal = total;
            document.getElementById('total').innerText = formatNum(currentTotal);
            if (targetValue !== null && currentTotal === targetValue) showSuccess();
        }

        function generateChallenge() {
            resetAbacus();
            startTimer();
            const min = 10 ** (level - 1);
            const max = (10 ** level) - 1;
            targetValue = BigInt(Math.floor(Math.random() * (max - min + 1)) + min);
            document.getElementById('challengeBox').style.display = 'block';
            document.getElementById('challengeText').innerText = i18n[currentLang].challengeLabel + formatNum(targetValue);
        }

        function showSuccess() {
            stopTimer();
            const msg = i18n[currentLang].successMsg.replace('{num}', formatNum(targetValue)).replace('{time}', formatNum(sec));
            document.getElementById('successTitle').innerText = i18n[currentLang].successTitle;
            document.getElementById('successMsg').innerText = msg;
            document.getElementById('successModal').style.display = 'flex';
            confettiEffect();
        }

        function nextLevel() {
            if (level < 7) level++;
            saveProgress();
            updateLevelDisplay();
            closeSuccess();
            generateChallenge();
        }

        function closeSuccess() { document.getElementById('successModal').style.display = 'none'; }

        function confettiEffect() {
            for(let i=0; i<80; i++) {
                setTimeout(() => createSparkle(Math.random() * window.innerWidth, Math.random() * window.innerHeight), i * 15);
            }
        }

        function toggleVisibility() { 
            isVisible = !isVisible; 
            const totalDiv = document.getElementById('total');
            const eyeBtn = document.getElementById('eyeBtn');
            if(isVisible) { totalDiv.classList.add('show'); eyeBtn.classList.add('active'); } 
            else { totalDiv.classList.remove('show'); eyeBtn.classList.remove('active'); }
        }

        function resetAbacus() {
            document.querySelectorAll('.bead').forEach(b => b.classList.remove('active'));
            updateScore();
        }

        function startTimer() { 
            clearInterval(interval); 
            sec = 0;
            const timerEl = document.getElementById('timer');
            const timerIcon = document.getElementById('timerIcon');
            timerIcon.classList.add('timer-icon-active'); 
            timerEl.innerText = formatNum(sec).padStart(2, currentLang === 'ar' ? 'Ù ' : '0');
            interval = setInterval(() => { 
                sec++; 
                timerEl.innerText = formatNum(sec).padStart(2, currentLang === 'ar' ? 'Ù ' : '0'); 
            }, 1000); 
        }

        function stopTimer() {
            clearInterval(interval);
            document.getElementById('timerIcon').classList.remove('timer-icon-active');
        }

        window.onload = () => { 
            loadProgress();
            initAbacus(); 
        };
    </script>
</body>
</html>
