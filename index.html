<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Omar - El Mo3dad</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');

:root{
    --wood-frame:#3d2b1f;
    --bead-5:#3498db;
    --bead-1:#2ecc71;
    --bead-active:#f39c12;
    --beam:#2a1d15;
}

body{
    background:#0f172a;
    font-family:'Cairo',sans-serif;
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    margin: 0;
}

.result-wrapper{
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:20px;
    background:rgba(30,41,59,0.8);
    padding:10px 25px;
    border-radius:20px;
    border: 2px solid #334155;
}

.result-value{
    font-size:2.5rem;
    font-weight:900;
    color:#fbbf24;
    min-width:120px;
    text-align:center;
    /* التحكم في الظهور */
    visibility: hidden; 
    transition: all 0.2s;
}

.result-value.show {
    visibility: visible;
}

.toggle-eye {
    cursor: pointer;
    background: #334155;
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s;
}

.toggle-eye:hover {
    background: #475569;
}

.scroll-wrapper{
    width: 100%;
    overflow-x: auto;
    padding: 40px 10px;
    display: flex;
    justify-content: flex-start;
}

@media (min-width: 1024px) {
    .scroll-wrapper { justify-content: center; }
}

.abacus-container{
    background:var(--wood-frame);
    padding:25px 15px;
    border:12px solid #1a130e;
    border-radius:20px;
    display:flex;
    gap:12px;
    position:relative;
}

.middle-beam{
    position:absolute;
    left:0;
    right:0;
    top:155px;
    height:28px;
    background:var(--beam);
    z-index:100;
}

.column{
    width:80px;
    height:540px;
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
}

.column-title{
    position:absolute;
    top:-45px;
    font-weight:900;
    color:#cbd5e1;
    font-size: 0.85rem;
    white-space: nowrap;
}

.rod{
    position:absolute;
    width:10px;
    height:100%;
    background:linear-gradient(to right,#94a3b8,#f8fafc,#64748b);
    border-radius:5px;
}

.upper-room{ width:100%; height:155px; position:relative; }
.lower-room{ width:100%; height:357px; margin-top:28px; position:relative; }

.bead{
    width:76px;
    height:48px;
    clip-path:polygon(25% 0%,75% 0%,100% 50%,75% 100%,25% 100%,0% 50%);
    position:absolute;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:transform .25s cubic-bezier(.18,.89,.32,1.2);
    user-select: none;
}

.bead-text{ font-weight:900; font-size:1.4rem; color:white; }
.bead-5{ background:var(--bead-5); top:15px; }
.bead-5.active{ transform:translateY(var(--drop-distance)); background:var(--bead-active); }
.bead-1{ background:var(--bead-1); }
.bead-1.active{ transform:translateY(-48px); background:var(--bead-active); }

.idx-1{ top:140px;}
.idx-2{ top:192px;}
.idx-3{ top:244px;}
.idx-4{ top:296px;}

.reset-btn{
    margin-top:25px;
    background:#e11d48;
    padding:12px 60px;
    border-radius:50px;
    font-weight:900;
    font-size:1.4rem;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="result-wrapper">
    <!-- أيقونة العين للتحكم -->
    <button class="toggle-eye" onclick="toggleResult()" title="إظهار/إخفاء النتيجة">
        <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
            <!-- خط الإخفاء الافتراضي -->
            <line id="eyeLine" x1="1" y1="1" x2="23" y2="23" style="display: block;"></line>
        </svg>
    </button>
    <div class="result-value" id="total">٠</div>
</div>

<div class="scroll-wrapper">
    <div class="abacus-container">
        <div class="middle-beam"></div>
        <div id="rodsGrid" class="flex gap-2"></div>
    </div>
</div>

<button class="reset-btn" onclick="resetAbacus()">تصفير</button>

<script>
const grid=document.getElementById('rodsGrid');
const totalDisplay=document.getElementById('total');
const eyeLine=document.getElementById('eyeLine');
const arabicColumns=["مليار","١٠٠ مليون","١٠ مليون","مليون","١٠٠ ألف","١٠ آلاف","ألف","مئات","عشرات","آحاد"];

let currentTotal=0n;
let isVisible = false;

function toggleResult() {
    isVisible = !isVisible;
    if(isVisible) {
        totalDisplay.classList.add('show');
        eyeLine.style.display = 'none'; // إزالة الخط من على العين
    } else {
        totalDisplay.classList.remove('show');
        eyeLine.style.display = 'block'; // وضع خط على العين
    }
}

function initAbacus(){
    grid.innerHTML = '';
    arabicColumns.forEach((name,i)=>{
        const col=document.createElement('div');
        col.className='column';
        col.innerHTML=`
            <div class="column-title">${name}</div>
            <div class="rod"></div>
            <div class="upper-room">
                <div class="bead bead-5" onclick="this.classList.toggle('active');updateScore();">
                    <span class="bead-text">5</span>
                </div>
            </div>
            <div class="lower-room">
                <div class="bead bead-1 idx-1" onclick="handleLower(this,1)"><span class="bead-text">1</span></div>
                <div class="bead bead-1 idx-2" onclick="handleLower(this,2)"><span class="bead-text">1</span></div>
                <div class="bead bead-1 idx-3" onclick="handleLower(this,3)"><span class="bead-text">1</span></div>
                <div class="bead bead-1 idx-4" onclick="handleLower(this,4)"><span class="bead-text">1</span></div>
            </div>
        `;
        grid.appendChild(col);
    });
}

function calculateDropDistance(){
    const beam=document.querySelector('.middle-beam');
    const bead=document.querySelector('.bead-5');
    const upper=document.querySelector('.upper-room');
    if(!beam || !bead || !upper) return;
    const distance=beam.getBoundingClientRect().top - upper.getBoundingClientRect().top - bead.offsetHeight - 4;
    document.documentElement.style.setProperty('--drop-distance',distance+'px');
}

function handleLower(element,index){
    const beads=element.parentElement.querySelectorAll('.bead-1');
    const currentState=element.classList.contains('active');
    beads.forEach((bead,i)=>{
        const bIndex=i+1;
        if(!currentState && bIndex<=index) bead.classList.add('active');
        else if(currentState && bIndex>=index) bead.classList.remove('active');
    });
    updateScore();
}

function updateScore(){
    let result=0n;
    const columns=document.querySelectorAll('.column');
    columns.forEach((col,i)=>{
        let colVal=0;
        if(col.querySelector('.bead-5').classList.contains('active')) colVal+=5;
        col.querySelectorAll('.bead-1.active').forEach(()=>colVal+=1);
        const power=BigInt(arabicColumns.length-1-i);
        result+=BigInt(colVal)*(10n**power);
    });
    currentTotal=result;
    totalDisplay.innerText=currentTotal.toLocaleString('ar-EG');
}

function resetAbacus(){
    document.querySelectorAll('.bead').forEach(b=>b.classList.remove('active'));
    updateScore();
}

initAbacus();
window.addEventListener('load', () => { calculateDropDistance(); updateScore(); });
window.addEventListener('resize', calculateDropDistance);
</script>

</body>
</html>
